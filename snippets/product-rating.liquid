{% comment %}
  Snippet name: product-rating
  Displays product rating stars and review count
{% endcomment %}

{%- assign rating_decimal = 0 -%}
{%- assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1 -%}
{%- if decimal >= 0.3 and decimal <= 0.7 -%}
  {%- assign rating_decimal = 0.5 -%}
{%- elsif decimal > 0.7 -%}
  {%- assign rating_decimal = 1 -%}
{%- endif -%}

<div class="rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}">
  <span aria-hidden="true" class="rating-stars">
    {%- for i in (1..5) -%}
      {%- if i <= product.metafields.reviews.rating.value.rating -%}
        ★
      {%- elsif i == product.metafields.reviews.rating.value.rating and rating_decimal == 0.5 -%}
        ½
      {%- else -%}
        ☆
      {%- endif -%}
    {%- endfor -%}
  </span>
  {% if product.metafields.reviews.rating_count %}
    <span class="rating-count">({{ product.metafields.reviews.rating_count }})</span>
  {% endif %}
</div>