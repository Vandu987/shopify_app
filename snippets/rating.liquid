{%- assign rating = product.metafields.custom.rating.value | default: 0 -%}

{%- assign rounded_rating = rating | times: 2 | round | divided_by: 2 -%}
{%- assign full_stars = rounded_rating | floor -%}
{%- assign has_half_star = rounded_rating > full_stars -%}
{%- assign empty_stars = 5 | minus: full_stars | minus: has_half_star -%}

<div class="product-rating">
  {%- for i in (1..full_stars) -%}
    <svg class="star-icon" viewBox="0 0 24 24">
      <path fill="#FFD700" d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.998 
        1.504 8.313L12 18.896l-7.44 4.721 
        1.504-8.313-6.064-5.998 
        8.332-1.151z"/>
    </svg>
  {%- endfor -%}

  {%- if has_half_star -%}
    <svg class="star-icon" viewBox="0 0 24 24">
      <defs>
        <linearGradient id="half-grad" x1="0" y1="0" x2="1" y2="0">
          <stop offset="50%" stop-color="#FFD700"/>
          <stop offset="50%" stop-color="#e0e0e0"/>
        </linearGradient>
      </defs>
      <path fill="url(#half-grad)" d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.998 
        1.504 8.313L12 18.896l-7.44 4.721 
        1.504-8.313-6.064-5.998 
        8.332-1.151z"/>
    </svg>
  {%- endif -%}

  {%- for i in (1..empty_stars) -%}
    <svg class="star-icon" viewBox="0 0 24 24">
      <path fill="#e0e0e0" d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.998 
        1.504 8.313L12 18.896l-7.44 4.721 
        1.504-8.313-6.064-5.998 
        8.332-1.151z"/>
    </svg>
  {%- endfor -%}
</div>
