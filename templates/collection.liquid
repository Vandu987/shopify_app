{% paginate collection.products by 12 %}
<div class="collection-wrapper">

  <!-- Sidebar Filters -->
  <aside class="collection-sidebar">
    <h4>Availability</h4>
    <label>
      <input type="checkbox" onchange="location.href='{{ collection.url }}?constraint=in-stock';" {% if current_tags contains 'in-stock' %}checked{% endif %}>
      In stock
    </label>

    <h4>Tags</h4>
    <ul>
      {% for tag in collection.all_tags %}
        <li>
          <a href="{{ collection.url }}{{ tag | link_to_tag }}">
            {% if current_tags contains tag %}
              <strong>{{ tag }}</strong>
            {% else %}
              {{ tag }}
            {% endif %}
          </a>
        </li>
      {% endfor %}
    </ul>
  </aside>

  <!-- Main Content -->
  <div class="collection-main">

    <!-- Top Bar -->
    <div class="collection-toolbar">
      <h1>{{ collection.title }}</h1>

      <div class="collection-controls">
        <div class="view-toggle">
          <a href="#" class="grid-view active">üî≥</a>
          <a href="#" class="list-view">üìÑ</a>
        </div>

        <form method="get" id="SortByForm">
          <select name="sort_by" id="SortBy" onchange="this.form.submit()">
            <option value="best-selling" {% if collection.sort_by == "best-selling" %}selected{% endif %}>Featured</option>
            <option value="price-ascending" {% if collection.sort_by == "price-ascending" %}selected{% endif %}>Price: Low to High</option>
            <option value="price-descending" {% if collection.sort_by == "price-descending" %}selected{% endif %}>Price: High to Low</option>
            <option value="title-ascending" {% if collection.sort_by == "title-ascending" %}selected{% endif %}>A-Z</option>
            <option value="title-descending" {% if collection.sort_by == "title-descending" %}selected{% endif %}>Z-A</option>
          </select>
        </form>
      </div>
    </div>

    <!-- Product Grid -->
    {% if collection.products.size > 0 %}
      <div class="product-grid-view">
        {% for product in collection.products %}
          <div class="product-card">
            <a href="{{ product.url | within: collection }}">
              <div class="product-image">
                <img src="{{ product.featured_image | img_url: '400x' }}" alt="{{ product.title }}">
                {% assign first_variant = product.variants.first %}
                {% if product.compare_at_price_max > product.price %}
                  {% assign discount = 100 | minus: product.price | times: 100 | divided_by: product.compare_at_price_max %}
                  <span class="badge sale">-{{ discount | round }}%</span>
                {% endif %}
              </div>
            </a>

            <div class="product-info">
              <div class="stars">‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è</div>
              <a class="title" href="{{ product.url }}">{{ product.title }}</a>

              <div class="price">
                {% if product.compare_at_price_max > product.price %}
                  <span class="new">{{ product.price | money }}</span>
                  <span class="old">{{ product.compare_at_price_max | money }}</span>
                {% else %}
                  <span class="new">{{ product.price | money }}</span>
                {% endif %}
              </div>

              <form method="post" action="/cart/add">
                <input type="hidden" name="id" value="{{ first_variant.id }}">
                {% if first_variant.available %}
                  <button type="submit">Add to cart</button>
                {% else %}
                  <button type="submit" disabled>Sold Out</button>
                {% endif %}
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No products found.</p>
    {% endif %}

    <div class="pagination">
      {{ paginate | default_pagination }}
    </div>

  </div>

</div>
{% endpaginate %}
