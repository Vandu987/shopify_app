{% paginate collection.products by 12 %}
<div class="collection-wrapper">

  <!-- Sidebar Filters -->
  <aside class="collection-sidebar">
    <h3>Filter by Availability</h3>
    <label>
      <input type="checkbox" onchange="location.href='{{ collection.url }}?constraint=in-stock';" {% if current_tags contains 'in-stock' %}checked{% endif %}>
      In stock
    </label>

    <h3>Filter by Tags</h3>
    <ul class="tag-filter">
      {% for tag in collection.all_tags %}
        <li>
          <a href="{{ collection.url }}/{{ tag | handle }}">
            {% if current_tags contains tag %}
              <strong>{{ tag }}</strong>
            {% else %}
              {{ tag }}
            {% endif %}
          </a>
        </li>
      {% endfor %}
    </ul>
  </aside>

  <!-- Main Content -->
  <div class="collection-main">

    <!-- Toolbar -->
    <div class="collection-toolbar">
      <h1>{{ collection.title }}</h1>

      <div class="controls">
        <!-- Sort -->
        <form method="get">
          <select name="sort_by" onchange="this.form.submit()">
            <option value="best-selling" {% if collection.sort_by == 'best-selling' %}selected{% endif %}>Featured</option>
            <option value="price-ascending" {% if collection.sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
            <option value="price-descending" {% if collection.sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
            <option value="title-ascending" {% if collection.sort_by == 'title-ascending' %}selected{% endif %}>A-Z</option>
            <option value="title-descending" {% if collection.sort_by == 'title-descending' %}selected{% endif %}>Z-A</option>
          </select>
        </form>

        <!-- View Toggle -->
        <div class="view-toggle">
          <button type="button" class="toggle-grid active">Grid</button>
          <button type="button" class="toggle-list">List</button>
        </div>
      </div>
    </div>

    <!-- Product Grid/List -->
    {% if collection.products.size > 0 %}
      <div class="products-container grid-view" id="productGrid">
        {% for product in collection.products %}
          <div class="product-card">
            <a href="{{ product.url | within: collection }}">
              <div class="product-image">
                <img src="{{ product.featured_image | img_url: '400x' }}" alt="{{ product.title }}">
                {% assign first_variant = product.variants.first %}
                {% if product.compare_at_price_max > product.price %}
                  {% assign discount = 100 | minus: product.price | times: 100 | divided_by: product.compare_at_price_max %}
                  <span class="badge sale">-{{ discount | round }}%</span>
                {% endif %}
              </div>
            </a>

            <div class="product-info">
              <h2><a href="{{ product.url }}">{{ product.title }}</a></h2>

              <div class="price">
                {% if product.compare_at_price_max > product.price %}
                  <span class="current">{{ product.price | money }}</span>
                  <span class="compare">{{ product.compare_at_price_max | money }}</span>
                {% else %}
                  <span class="current">{{ product.price | money }}</span>
                {% endif %}
              </div>

              <form method="post" action="/cart/add">
                <input type="hidden" name="id" value="{{ first_variant.id }}">
                {% if first_variant.available %}
                  <button type="submit">Add to cart</button>
                {% else %}
                  <button disabled>Sold Out</button>
                {% endif %}
              </form>
            </div>
          </div>
        {% endfor %}
      </div>

    {% else %}
      <p>No products found.</p>
    {% endif %}

    <div class="pagination">
      {{ paginate | default_pagination }}
    </div>

  </div>
</div>

<!-- View Switcher JS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const gridBtn = document.querySelector('.toggle-grid');
  const listBtn = document.querySelector('.toggle-list');
  const productGrid = document.getElementById('productGrid');

  if(gridBtn && listBtn && productGrid){
    gridBtn.addEventListener('click', function () {
      productGrid.classList.add('grid-view');
      productGrid.classList.remove('list-view');
      gridBtn.classList.add('active');
      listBtn.classList.remove('active');
    });

    listBtn.addEventListener('click', function () {
      productGrid.classList.add('list-view');
      productGrid.classList.remove('grid-view');
      listBtn.classList.add('active');
      gridBtn.classList.remove('active');
    });
  }
});
</script>
{% endpaginate %}
